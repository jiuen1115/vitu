左边的图片来自电影《upside down》的海报。电影中存在着两个上下颠倒的城市，互为对方的反向世界。两个世界通过一座巨塔进行有限的沟
通，反向合约（Inverse Contract）也许就有点像是这么一座巨塔，连接着传统金融和数字货币两端的衍生品市场。
　   开始玩币圈的小伙伴，可能会被一些名词搞晕掉，不知道什么叫正向合约，什么是反向合约。接下来就让我们一同了解下这两类合约。先给个简
介
　   反向合约：只有数字货币世界（或称“币圈”）才有的一种特殊衍生品合约规则；
　   正向合约：除了反向合约以外，其他所有的金融市场（股票、期货、期权等等）采用的合约规则。
　   简单来说，反向合约也称为币本位合约，也是目前市场上主流交易所都在采用的合约方式，即用户需持有多个币种做对应交易。也就是说，你要
开BTC的合约交易就得持有BTC，要开ETH的合约交易就得持有ETH，使用哪个币种开合约交易，最终收益也是对应币种。
　  看到这里你可能又懵逼了，已经准备要将鼠标移到右上角的Ｘ标记上。如果你对数字货币市场的“新鲜事物”充满好奇心，或者本身就是数字货
币投资者（甚至已经投身币圈量化交易），那么不妨继续看下去，相信接下来的内容会让你有所收获。
　  绝大部分数字货币相关的衍生品都采用了反向合约的设计，包括：反向期货、反向永续、反向期权等。尽管被许多币圈交易所采用，但反向合约
本身并没有一个非常正式（或者说学术化）的定义，这里我们尽可能用“人话”来总结一个定义：
　  反向合约是指用USD来标识价格，用BTC来结算盈亏的衍生品合约。
　  其中：
    • 　　　USD可以是其他计价法币；
    • 　　
    •              BTC也可以是其他数字货币。
　  同时作为一个对比：
　  正向合约是指用USD来标识价格，用USD来结算盈亏的衍生品合约。
　看到这里可能还不足以使你彻底理解反向合约的定义，甚至可能让你更懵逼。我们使用两个具体的案例来说明一下正向合约和反向合约的区别。　
　正向合约方面选择芝商所（CME）的比特币期货，反向合约方面则选择BITMEX交易所的比特币永续合约。


交易所
CME
BITMEX
类型
正向合约
反向合约
标的物
５个BTC
1USD对应的BTC
合约乘数
5
1
最小跳动
5
0.5
计价方式
USD
USD
结算方式
USD
BTC
　　其中合约乘数的意思是指，一张合约包含的交易标的数量。比如CME的合约乘数为５，表示的是一张CME的BTC期货合约含有５个BTC。同理，一张BITMEX的BTC合约含有的是与１个USD等值的BTC。最小跳动表示的是合约在
计价时候的价格最小变动单位，比如CME的BTC期货价格最小变动是５USD，BITMEX的BTC合约价格最小变动是0.5USD。因为CME的结算方式是USD，所以CME接受USD作为资金存入账户进行交易，而BITMEX的结算方式是BTC，
所以只接受BTC作为资金存入账户中。目前的时间是2020年５月20日，BTC的价格是9460美元左右，我们四舍五入取个9000美元吧。假设我们现在以9000美元(开仓价)的价格分别买入１手CME的BTC期货（面值为45000美元）和
1000张BITMEX的永续合约（面值为(1000/9000)即1/9个BTC），后续比特币的价格上涨到了10000美元（平仓价），则两个交易所合约的盈亏情况（为便于理解，不计佣金、资金费率等其他费用）分别是：
    • CME的正向合约
        ◦ 盈亏金额：
            ▪ (10000- 9000) x 5 x 1= 5000 USD
        ◦ 计算公式：
            ▪ (平仓价 - 开仓价) x 合约乘数 x 仓位 = USD盈亏
        ◦ 背后逻辑：
            ▪ 以开仓价买入5个BTC，并以平仓价卖出5个BTC后，得到的盈亏是USD价格的变动值
            ▪ 　
        ◦ 讲人话：
            ▪ 昨天去菜场用９元/个的价格买了10个橘子，今天去菜场用10元/个的价格把这10个橘子全卖了，赚了１0元（货币）
    • BITMEX的反向合约
        ◦ 盈亏金额：
            ▪ (1 / 9000 - 1 / 10000) x 1 x 1000= 0.011111 BTC
        ◦ 计算公式：
            ▪ (1 / 开仓价 - 1 / 平仓价) x合约乘数 x仓位 = BTC盈亏
        ◦ 背后逻辑：
            ▪ 以开仓价买入1000USD等值数量的BTC，并以平仓价卖出1000USD等值数量的BTC，得到的盈亏是BTC数量的变动值
        ◦ 讲人话：
            ▪ 昨天去菜场用９元/个的价格买了(90元等值的)10个橘子，今天去菜场用10元/个的价格卖掉9个橘子(90元等值)，赚了１个橘子（商品）
其中正向合约计算公式背后的逻辑很容易理解。而反向合约名字里的【反向】两个字，则是体现在尽管计价还是使用的USD（货币），但在结算盈亏时则是使用的却是BTC（商品）。换个角度可以这么理解：与其说我们在买卖
BTC,不如说我们使用BTC作为结算货币，在买卖USD。我们在１美元/(1/9000个BTC)（为便于理解，以及与现货对应，标记为9000美元/BTC）的价格卖掉1000美元（账户里的BTC作为抵押），得到１/9个BTC。然后以１美元/
(1/10000个BTC)（也即10000美元/BTC）的价格买入1000美元，只需１/10个BTC，于是我们赚了1/9-1/10＝0.011111 BTC。
　　讲人话：正向合约盈亏的都是钱，反向合约盈亏的都是橘子。
　　搞明白了反向合约的概念，大家不禁要问，搞这个东西出来的意义是什么？为什么不直接用正向合约？
　　其实原因很简单，设计反向合约的核心目标是为了创造一个只有BTC(数字货币),而无USD(法定货币)，就可以自由交易的金融衍生品市场。
　　一是对理想的坚持：对于BTC的信仰，实现一个用BTC作为主要货币的世界。
　　二是对现实的妥协：基于法币结算的期货交易，需要拿到政府监管机构发放的正规期货交易所牌照，而早年的币圈交易所根本无法满足监管规定（也就拿不到了~）
　　在理想和现实的双重考虑下，反向合约就成为了币圈衍生品市场的主流合约，绝大部分数字货币相关的衍生品都采用了反向合约的设计，包括：反向期货、反向永续、反向期权等。在介绍完反向合约后，我们再来学习一下永续合约
的概念。


二　永续合约
　　永续合约是一种介于现货和期货之间的金融衍生品，没有交割日，不受限于时间，更适合作为投资产品持有的永不到期的类期货合约。
　　永续合约是相对交割合约来说的一个概念，我们平常使用的交割合约有固定的交割期，到交割日要结算交付，而永续合约没有期限限制。同时，永续合约引入资金费用机制，并通过资金费用机制，使永续合约的价格回归现货指数
价格，因此与交割合约不同，永续合约的价格在绝大部分时间不会偏离现货价格太多。因为具备这些特点，套利者使用永续合约执行策略时，不需要担心合约交割而价差还没有向预期方向变化而产生额外的换仓成本，可以长期持仓，
不受交割期的影响，可以使你的交易更加灵活。套保者也可以使用永续合约可以方便地选择套保时间。
　　根据合约计价单位和缴纳保证金基准单位的关系，永续合约分为正向合约和反向合约。
        下面我们就以第一个面市的、也是目前市场上交易量最大的bitmex的XBTUSD永续反向合约为例，详细介绍一下永续合约的相关规则和特点。
bitmex的XBTUSD永续合约
品种
合约类型
合约规模
计价价格
盈亏结算货币
最小变动单位
初始保证金率
维持保证金率
到期日期
提供流动性费率
提取流动性费率
多仓资金费率
空仓资金费率
资金费率时间段
XBTUSD
反向合约
１USD
USD/BTC
    XBT
0.5 USD
最小为１％
初始保证金率的一半
永不到期
-0.0250%
0.0750%
0.0100%(动态调整)
-0.0100%(动态调整)
每８小时
　　其中XBTUSD中的XBT代表的就是BTC
　　１　合约规格
　　XBTUSD是以XBT作为结算货币，以USD为计价单位，一张合约为等值１USD的XBT,价格最小变动单位为0.5USD的永不到期的反向合约。
　　２　盈亏计算
　　盈亏=合约数量 * 乘数 * (1/开仓价格 - 1/平仓价格)
　　乘数定为1，这个盈亏计算看上去是非线性的，但实际上是线性的，只是由于根据比特币计价结算才显得非线性。比如，开多仓1000手，开仓价格比特币5000美元1个，平仓价格6000美元一个，那计算的盈亏是0.0333个比特币。
但实际上换算成美元是当初买了1000/5000=0.2个比特币，1个比特币价格涨了1000美元，那么0.2个比特币赚了200美元，折合成现价比特币是200/6000=0.0333个比特币。
　　３　杠杆
　由上述表格可以看出bitmex的XBTUSD永续合约中，初始开仓的时候最大杠杆可以达到100倍，即使用1%的保证金买卖100%规模的合约。bitmex中持仓模式分为两种，
　（１）全仓模式：开单之后，账户所有资金都作为保证金。：随着价格波动，你仓位实际价值是不断变动，保证金金额依然不变，于是会导致实际杠杆不断变化。
　（２）逐仓模式：每开一笔单子之后，根据设定的杠杆倍数，锁定对应的保证金金额作为这单的独有保证金与账户剩下的余额隔离，使得这单的杠杆、保证金金额、强平价是固定不变的。
　　　
　　bitmex上的杠杆是可以选择调整的。使用逐仓保证金模式，仓位锁定的保证金是与交易者的账户余额分隔开的，这种模式允许交易者自己调整杠杆倍数，自动调整仓位风险收益和强平价格。当价格波动到被强制平仓的情况时，
最大损失限制于持仓的仓位保证金（杠杆倍数锁定的初始保证金），不会波及到被隔离的账户余额。同时开仓后还可以追加保证金，追加保证金后，杠杆可以降到1倍以下。如图所示：
　　
　　通过增加保证金可以使杠杆率减少到1倍以下，上图增加保证金后实际杠杆率降到了0.28倍。其实期货危险是因为动用了高杠杆，自己控制好仓位，控制杠杆率其实风险并不高。举个例子，用100000人民币去买股票和用10000人
民币买期货，剩下90000人民币作为保证金，效果是一样的。人为降低杠杆率可以降低风险。在比特币领域经常有大资金急拉急压价格，导致空头和多头爆仓，所以不推荐高杠杆操作。
　　４　标记价格
       　bitmex创新引入了一个在币圈里独特的概念，合理标记价格，简称标记价格。我们在看自己BitMEX上的仓位的时候，可以发现在开仓价格旁边有一个“标记价格”，而这个价格和开仓价格的差距还是挺大的，那么这个价格是干
嘛用的呢？
　　
　　标记价格：此价格用于计算盈亏和保证金，并有可能与合约最新成交价有偏差以避免市场操控，这不会影响结算。这个价格一个最重要的作用，那就是计算爆仓价格。使用标记价格而不是最新的交易价格作为保证金和强平价格计算
的标准，主要是为了避免由于市场被操纵或是缺乏流动性而与现货指数发生不必要的偏差，导致了不必要的强制平仓，也就是用户爆仓了。此外，标记价格只影响强平价格和未实现的盈亏，并不影响已实现盈亏。
　　对于永续合约，标记价格＝指数价格×（１＋资金费用基差率）
　　　　　　　　　资金费用基差率＝资金费率×（至下一个缴付资金费用的时间/资金费用时间间隔）
　　这里又涉及了两个概念：
　　（１）指数价格，XBT的指数价格是Bitstamp、Coinbase Pro和Kraken三家交易所的比特币价格的加权平均值，这里采用了三家交易所价格的综合平均值，也就避免了一家交易所价格被操纵带来的价格波动。
　　（２）资金费率，这个就是为了是合约价格和现货锚定，向持多仓和空仓收取或补贴的费用比率。资金费率存在的原因是永续合约，永不到期，为了使合约价格锚定现货价格，所以当期货合约价格高于现货价格时，多头就要给
空头一部分钱，这样多头就会平仓，使价格下降。当期货合约价格低于现货价格时，空头要给多头一部分钱，这样空头就会平仓，使价格上升。这样这个资金费率保证了合约价格尽量和现货价格一致，如果偏离了，由于资金费率可以使
之回复到现货价格。
　　如XBTUSD永续合约表格中给出的数据，多仓资金费率和空仓资金费率每8小时收取一次。如果费率为正，多仓将支付而空仓将获得资金费率，如果费率为负，则相反。只有在时间点上有仓位的人才会被收取或者获得资金费率。资
金时间戳：UTC 4:00（北京时间 12:00）、UTC 12:00（北京时间 20:00）和 UTC 20:00（北京时间 04:00）。
　　而资金费率在Bitmex交易所每５秒更新一次，其价格有一套基于利息和盘口深度加权价格、指数价格等因素的价格计算系统给出，在此就不多赘述了。
　　５　交易费用
　　和币圈现货交易一样，永续合约对交易中的taker和maker给予不同的佣金费率。提供流动性费（maker）率-0.0250%指的是，挂单后，被别人吃单，则你可以得到仓位的0.0250%btc作为收益，负数代表你拿钱，正数代表你付钱。
因为提供了流动性，所以成交的话你拿钱。而对于吃单的人（taker），要付提取流动性费率0.0750%。也就是吃单的人交易手续费是0.0750%。
　　６　其他规定
　　　（１）强制平仓
　　　　当交易保证金少于维持保证金时，进行强制平仓，XBTUSD是0.5%。强制平仓的剩余资金会进入保险基金，弥补那些未能强制平仓的投资者的损失。
　　　（２）自动减仓
                 Bitmex有自动减仓系统，当投资者被强制平仓时，他们的剩余仓位将被 BitMEX 的强平系统接管。 如果强平仓位未能够在市场平仓，并且当标记价格达到破产价格时，自动减仓系统将会对持有反方向仓位的投资者进行减仓。减
仓的先后顺序将根据杠杆和盈利比率决定。自动减仓将根据强平仓位的破产价格进行平仓。自动减仓会从盈利最多的投资者开始，目的是为了保持交易平台的稳定性。让亏的人少亏点，让过于盈利的投资者让渡出一部分利润。
              （３）委托种类
　　　　委托分为市价委托，限价委托，止盈委托和止损委托。还有追踪止损委托，举个例子：
　　　　数量 = 10 张合约
　　　　追踪价距 = 5
　　　　触发类型 = 标记价格
　　　　方向 = 买 (因为追踪价距是正值)
　　　　一旦用户提交此类型的委托，10 张合约的市价买委托将在标记价格上涨超过追踪价距 5 时被提交。 然而，如果标记价格下跌，那么此委托将会追踪此价格，并在标记价格至最低点上升超过追踪价距 5 时被执行。
　　    （４）高级委托功能
　　　　Bitmex还有高级委托功能。比如隐藏委托，冰山委托和被动委托。
　　　　隐藏委托是一个限价委托，但是它在委托列表中不可见。
　　　　冰山委托， 冰山委托是一种隐藏委托，它的一部分会被显示在公共的委托列表上。 因为聪明的交易者可以找出隐藏委托，一些交易者更愿意使用这种类型来使隐藏委托看起来更像是交易者在不断增加委托的数量。 举个例子：
一个 10 张合约限价于 100 的买委托将被提交至市场。 只有 1 张合约可被其他交易者看到。 如果某人在 100 卖出 3 张合约，则此 3 张合约被立刻成交。 之后，另 1 张合约将在 100 的价位被其他交易者看到。 因此，现在此委托有 7 张合
约未被成交，其中 1 张合约可见。　　
　　　　被动委托
　　　　被动委托是一种限价委托，而且仅仅在它们不会立刻成交的情况下被接受。 也就是说，被动委托永远不会提取流动性。 做市商使用被动委托来确保赚取做市商返佣。举个例子：
　　　　数量 = 10 张合约
　　　　限价 = 102
　　　　被动委托复选框 = 选中
　　　　方向 = 买
　　　　最佳卖价 = 101
　　　　在此示例中，如果被动委托复选框未被选中，那么此委托有可能在最佳卖价 101 成交而付出提取流动性佣金。 如果被动委托复选框被选中，该委托将 不会 被执行，并将被取消。 只有当最佳卖价高于 102，此委托才会被提交至
市场。

